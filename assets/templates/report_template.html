<!DOCTYPE html>
<html lang="pl" data-theme="auto">
<head>
  <!-- ============================================
       Intelligent Predictor — Report PRO v2.0
       Production-grade, print-ready, accessible
       ============================================ -->
  
  <!-- Meta Tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Intelligent Predictor v2.0">
  <meta name="format-detection" content="telephone=no">
  
  <!-- Document Metadata -->
  <title>{{ title or "Raport Analityczny" }} - Intelligent Predictor</title>
  <meta name="description" content="Raport wygenerowany przez Intelligent Predictor - {{ subtitle or 'Zaawansowana analiza danych' }}">
  <meta name="author" content="Intelligent Predictor">
  
  {% if run_meta and run_meta.timestamp %}
  <meta name="date" content="{{ run_meta.timestamp }}">
  {% endif %}
  
  <!-- Favicon (base64 embedded to avoid external dependency) -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>📊</text></svg>">

<style>
/* ====================================================================
   INTELLIGENT PREDICTOR — REPORT STYLESHEET v2.0
   ==================================================================== */

/* ---- CSS Custom Properties ---- */
:root {
  /* Brand Colors */
  --primary: #4A90E2;
  --primary-dark: #357ABD;
  --primary-light: #6BA3E8;
  --primary-rgb: 74, 144, 226;
  
  /* Semantic Colors */
  --success: #22c55e;
  --success-bg: rgba(34, 197, 94, 0.1);
  --warning: #f59e0b;
  --warning-bg: rgba(245, 158, 11, 0.1);
  --error: #ef4444;
  --error-bg: rgba(239, 68, 68, 0.1);
  --info: #3b82f6;
  --info-bg: rgba(59, 130, 246, 0.1);
  
  /* Neutrals - Dark Theme (Default) */
  --color-bg: #0f1216;
  --color-surface: #151a21;
  --color-surface-variant: #1d2229;
  --color-text: #e7ecf3;
  --color-text-secondary: #a5adba;
  --color-text-tertiary: #6b7280;
  --color-border: #263040;
  --color-border-light: #323a4a;
  
  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.25);
  --shadow-lg: 0 12px 32px rgba(0, 0, 0, 0.35);
  --shadow-xl: 0 24px 48px rgba(0, 0, 0, 0.45);
  
  /* Spacing (4px base) */
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
  
  /* Border Radius */
  --radius-sm: 0.5rem;
  --radius-md: 0.75rem;
  --radius-lg: 1rem;
  --radius-full: 9999px;
  
  /* Typography */
  --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, 
               "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
  --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, 
               "Liberation Mono", "Courier New", monospace;
  
  --font-size-xs: 0.75rem;
  --font-size-sm: 0.875rem;
  --font-size-base: 0.9375rem;
  --font-size-lg: 1rem;
  --font-size-xl: 1.125rem;
  --font-size-2xl: 1.375rem;
  --font-size-3xl: 1.75rem;
  
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  
  --line-height-tight: 1.25;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.75;
  
  /* Container */
  --container-max-width: 1140px;
  --container-padding: 1.5rem;
  
  /* Transitions */
  --transition-fast: 150ms ease-in-out;
  --transition-base: 200ms ease-in-out;
}

/* ---- Light Mode ---- */
@media (prefers-color-scheme: light) {
  :root {
    --color-bg: #f7f9fc;
    --color-surface: #ffffff;
    --color-surface-variant: #f1f3f7;
    --color-text: #14171a;
    --color-text-secondary: #4b5563;
    --color-text-tertiary: #9ca3af;
    --color-border: #e5e7eb;
    --color-border-light: #d1d5db;
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 12px 32px rgba(0, 0, 0, 0.12);
  }
}

/* Light mode class override */
[data-theme="light"] {
  --color-bg: #f7f9fc;
  --color-surface: #ffffff;
  --color-surface-variant: #f1f3f7;
  --color-text: #14171a;
  --color-text-secondary: #4b5563;
  --color-text-tertiary: #9ca3af;
  --color-border: #e5e7eb;
  --color-border-light: #d1d5db;
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 12px 32px rgba(0, 0, 0, 0.12);
}

/* ---- Reduced Motion ---- */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ====================================================================
   BASE STYLES
   ==================================================================== */

*,
*::before,
*::after {
  box-sizing: border-box;
}

html {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  scroll-behavior: smooth;
  font-size: 16px;
}

body {
  margin: 0;
  padding: 0;
  background: var(--color-bg);
  color: var(--color-text);
  font-family: var(--font-sans);
  font-size: var(--font-size-base);
  line-height: var(--line-height-normal);
  overflow-x: hidden;
}

/* ---- Typography ---- */
h1, h2, h3, h4, h5, h6 {
  margin: 0 0 var(--space-md) 0;
  font-weight: var(--font-weight-bold);
  line-height: var(--line-height-tight);
  letter-spacing: -0.02em;
  color: var(--color-text);
}

h1 {
  font-size: var(--font-size-3xl);
  font-weight: 800;
  margin-bottom: var(--space-sm);
}

h2 {
  font-size: var(--font-size-2xl);
  margin-top: var(--space-xl);
  padding-bottom: var(--space-sm);
  border-bottom: 1px solid var(--color-border);
}

h3 {
  font-size: var(--font-size-xl);
  color: var(--color-text-secondary);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-sm);
}

p, li {
  color: var(--color-text);
  line-height: var(--line-height-relaxed);
  margin: 0 0 var(--space-md) 0;
}

ul, ol {
  padding-left: var(--space-lg);
  margin: 0 0 var(--space-md) 0;
}

li {
  margin-bottom: var(--space-sm);
}

small {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

strong, b {
  font-weight: var(--font-weight-semibold);
}

a {
  color: var(--primary);
  text-decoration: none;
  transition: color var(--transition-fast);
}

a:hover {
  color: var(--primary-dark);
  text-decoration: underline;
}

/* ---- Code & Pre ---- */
code,
kbd,
samp,
pre {
  font-family: var(--font-mono);
  font-size: 0.9em;
  background: var(--color-surface-variant);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

code,
kbd,
samp {
  padding: 0.125rem 0.375rem;
}

pre {
  padding: var(--space-md);
  overflow-x: auto;
  line-height: var(--line-height-relaxed);
  margin: var(--space-md) 0;
  white-space: pre-wrap;
  word-wrap: break-word;
}

pre code {
  background: none;
  border: none;
  padding: 0;
}

/* ====================================================================
   LAYOUT
   ==================================================================== */

.container {
  max-width: var(--container-max-width);
  margin: 0 auto;
  padding: var(--container-padding);
  contain: layout style;
}

.card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--space-xl);
  margin: var(--space-lg) 0;
  box-shadow: var(--shadow-md);
  page-break-inside: avoid;
  break-inside: avoid;
  contain: layout style;
}

.card--compact {
  padding: var(--space-lg);
}

.card--highlight {
  border-color: var(--primary);
  box-shadow: 0 0 0 1px var(--primary), var(--shadow-md);
}

/* Grid Layouts */
.grid-2 {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-lg);
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-lg);
}

.grid-4 {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: var(--space-md);
}

/* ====================================================================
   HEADER
   ==================================================================== */

.header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: var(--space-lg);
  margin-bottom: var(--space-2xl);
  padding-bottom: var(--space-lg);
  border-bottom: 2px solid var(--color-border);
  page-break-after: avoid;
}

.brand {
  display: flex;
  align-items: center;
  gap: var(--space-md);
}

.logo {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-md);
  background: linear-gradient(145deg, var(--color-surface-variant), var(--color-surface));
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--color-border);
  flex-shrink: 0;
  font-size: 1.5rem;
  font-weight: 800;
  color: var(--primary);
}

.meta {
  text-align: right;
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  align-items: flex-end;
}

/* ====================================================================
   BADGES & TAGS
   ==================================================================== */

.badge {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.625rem;
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  border: 1px solid var(--color-border);
  color: var(--color-text-secondary);
  background: var(--color-surface-variant);
  white-space: nowrap;
}

.badge--primary {
  border-color: var(--primary);
  color: var(--primary);
  background: rgba(var(--primary-rgb), 0.1);
}

.badge--success {
  border-color: var(--success);
  color: var(--success);
  background: var(--success-bg);
}

.badge--warning {
  border-color: var(--warning);
  color: var(--warning);
  background: var(--warning-bg);
}

.badge--error {
  border-color: var(--error);
  color: var(--error);
  background: var(--error-bg);
}

.tag {
  display: inline-block;
  padding: 0.25rem 0.5rem;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  margin-right: var(--space-sm);
  margin-bottom: var(--space-xs);
}

/* ====================================================================
   KPI CARDS
   ==================================================================== */

.kpis {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: var(--space-md);
  margin: var(--space-lg) 0;
}

.kpi {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-lg);
  box-shadow: var(--shadow-sm);
  transition: transform var(--transition-base), box-shadow var(--transition-base);
  page-break-inside: avoid;
}

.kpi:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.kpi .label {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  margin-bottom: var(--space-xs);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.kpi .value {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
  line-height: var(--line-height-tight);
  margin-bottom: var(--space-sm);
  font-variant-numeric: tabular-nums;
}

.kpi.ok .value {
  color: var(--success);
}

.kpi.warn .value {
  color: var(--warning);
}

.kpi.err .value {
  color: var(--error);
}

.kpi .delta {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
}

.kpi .delta.up {
  background: var(--success-bg);
  color: var(--success);
}

.kpi .delta.down {
  background: var(--error-bg);
  color: var(--error);
}

/* ====================================================================
   TABLES
   ==================================================================== */

.table-wrapper {
  overflow-x: auto;
  margin: var(--space-md) 0;
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-sm);
}

.table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  overflow: hidden;
  background: var(--color-surface);
  font-size: var(--font-size-sm);
}

.table thead th {
  background: var(--color-surface-variant);
  color: var(--color-text);
  font-weight: var(--font-weight-semibold);
  text-align: left;
  padding: 0.875rem 1rem;
  border-bottom: 2px solid var(--color-border);
  position: sticky;
  top: 0;
  z-index: 10;
}

.table tbody td {
  padding: 0.75rem 1rem;
  border-bottom: 1px solid var(--color-border);
  color: var(--color-text);
}

.table tbody tr:last-child td {
  border-bottom: none;
}

.table tbody tr:hover {
  background: var(--color-surface-variant);
}

.table tbody tr:nth-child(even) {
  background: rgba(255, 255, 255, 0.01);
}

/* Numeric alignment */
.table td[data-type="number"],
.table th[data-type="number"] {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

/* ====================================================================
   FIGURES & IMAGES
   ==================================================================== */

.figure {
  border: 1px dashed var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-md);
  text-align: center;
  background: var(--color-surface-variant);
  margin: var(--space-lg) 0;
  page-break-inside: avoid;
}

.figure img {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-sm);
  display: block;
  margin: 0 auto;
}

.figure figcaption {
  margin-top: var(--space-sm);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  font-style: italic;
}

/* ====================================================================
   FOOTER
   ==================================================================== */

.footer {
  margin-top: var(--space-2xl);
  padding-top: var(--space-lg);
  border-top: 1px solid var(--color-border);
  text-align: center;
  color: var(--color-text-tertiary);
  font-size: var(--font-size-sm);
}

.footer a {
  color: var(--color-text-secondary);
}

/* ====================================================================
   UTILITY CLASSES
   ==================================================================== */

.text-center { text-align: center; }
.text-right { text-align: right; }
.text-left { text-align: left; }

.text-muted { color: var(--color-text-secondary); }
.text-primary { color: var(--primary); }
.text-success { color: var(--success); }
.text-warning { color: var(--warning); }
.text-error { color: var(--error); }

.mt-0 { margin-top: 0; }
.mb-0 { margin-bottom: 0; }
.my-md { margin-top: var(--space-md); margin-bottom: var(--space-md); }

.font-mono { font-family: var(--font-mono); }
.font-weight-bold { font-weight: var(--font-weight-bold); }

.hr {
  height: 1px;
  background: var(--color-border);
  border: 0;
  margin: var(--space-xl) 0;
}

/* ====================================================================
   RESPONSIVE
   ==================================================================== */

@media (max-width: 840px) {
  :root {
    --container-padding: 1rem;
    --font-size-3xl: 1.5rem;
    --font-size-2xl: 1.25rem;
  }
  
  .header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .meta {
    align-items: flex-start;
    text-align: left;
  }
  
  .kpis {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .grid-2,
  .grid-3 {
    grid-template-columns: 1fr;
  }
  
  .grid-4 {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .card {
    padding: var(--space-lg);
  }
  
  .table-wrapper {
    margin-left: calc(var(--container-padding) * -1);
    margin-right: calc(var(--container-padding) * -1);
    border-radius: 0;
  }
}

@media (max-width: 480px) {
  .kpis,
  .grid-4 {
    grid-template-columns: 1fr;
  }
}

/* ====================================================================
   PRINT STYLES
   ==================================================================== */

@media print {
  @page {
    margin: 15mm;
    size: A4;
  }
  
  :root {
    --color-bg: white;
    --color-surface: white;
    --color-text: black;
    --color-text-secondary: #333;
    --color-border: #ccc;
    --shadow-md: none;
    --shadow-lg: none;
  }
  
  body {
    background: white;
    color: black;
    font-size: 11pt;
  }
  
  .container {
    max-width: 100%;
    padding: 0;
  }
  
  .header {
    page-break-after: avoid;
  }
  
  .card {
    box-shadow: none;
    border: 1px solid #ccc;
    page-break-inside: avoid;
  }
  
  .kpi {
    box-shadow: none;
  }
  
  h1, h2, h3 {
    page-break-after: avoid;
  }
  
  a {
    color: #0066cc;
    text-decoration: underline;
  }
  
  a[href^="http"]:after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
  }
  
  /* Hide interactive elements */
  .no-print {
    display: none !important;
  }
  
  /* Ensure tables don't break */
  table {
    page-break-inside: auto;
  }
  
  tr {
    page-break-inside: avoid;
    page-break-after: auto;
  }
  
  thead {
    display: table-header-group;
  }
  
  tfoot {
    display: table-footer-group;
  }
}

/* ====================================================================
   ACCESSIBILITY
   ==================================================================== */

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Focus styles */
:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* High contrast mode */
@media (prefers-contrast: high) {
  :root {
    --color-border: currentColor;
  }
  
  .card,
  .kpi,
  .table {
    border-width: 2px;
  }
}
</style>
</head>

<body>
  <!-- Skip to main content (accessibility) -->
  <a href="#main-content" class="sr-only">Przejdź do głównej treści</a>

  <div class="container">
    <!-- ============================================
         HEADER SECTION
         ============================================ -->
    <header class="header" role="banner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <span>IP</span>
        </div>
        <div>
          <h1>{{ title or "Raport Analityczny" }}</h1>
          {% if subtitle %}
          <span class="badge badge--primary">{{ subtitle }}</span>
          {% endif %}
        </div>
      </div>
      
      <div class="meta">
        {% if run_meta %}
          {% if run_meta.timestamp %}
          <div class="badge">
            <time datetime="{{ run_meta.timestamp }}">{{ run_meta.timestamp }}</time>
          </div>
          {% endif %}
          
          {% if run_meta.user %}
          <div class="badge">
            <span aria-label="Użytkownik">👤</span> {{ run_meta.user }}
          </div>
          {% endif %}
          
          {% if run_meta.version %}
          <div class="badge">v{{ run_meta.version }}</div>
          {% endif %}
        {% endif %}
      </div>
    </header>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main id="main-content" role="main">
      
      <!-- Executive Summary / KPIs -->
      {% if kpis %}
      <section aria-labelledby="kpi-heading">
        <h2 id="kpi-heading" class="sr-only">Kluczowe Wskaźniki</h2>
        <div class="kpis">
          {% for k in kpis %}
          <article class="kpi {{ k.status or '' }}">
            <div class="label">{{ k.label }}</div>
            <div class="value">
              {{ k.value }}
              {% if k.suffix %}<small>{{ k.suffix }}</small>{% endif %}
            </div>
            {% if k.delta is defined %}
            <div class="delta {{ 'up' if k.delta > 0 else 'down' if k.delta < 0 else '' }}">
              {% if k.delta > 0 %}▲{% elif k.delta < 0 %}▼{% endif %}
              {{ '%+.1f'|format(k.delta) }}{{ k.delta_suffix or '%' }}
            </div>
            {% endif %}
          </article>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      <!-- Context / Metrics -->
      <section class="card" aria-labelledby="metrics-heading">
        <h2 id="metrics-heading">Metryki i Kontekst</h2>
        
        {% if metrics %}
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Metryka</th>
                <th data-type="number">Wartość</th>
              </tr>
            </thead>
            <tbody>
              {% for key, value in metrics.items() %}
              <tr>
                <td><strong>{{ key }}</strong></td>
                <td data-type="number">
                  {% if value is number %}
                    {{ "%.4f"|format(value) if value < 1 else "%.2f"|format(value) }}
                  {% else %}
                    {{ value }}
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted">
          <span class="badge badge--warning">⚠️</span>
          Brak metryk — dołącz <code>metrics</code> w kontekście aby wypełnić tę sekcję.
        </p>
        {% endif %}
        
        {% if tags %}
        <div style="margin-top: var(--space-md);">
          <strong class="text-muted">Tagi:</strong><br>
          {% for t in tags %}
          <span class="tag">{{ t }}</span>
          {% endfor %}
        </div>
        {% endif %}
      </section>

      <!-- Insights & Recommendations -->
      {% if insights or recommendations %}
      <div class="grid-2">
        {% if insights %}
        <section class="card card--highlight" aria-labelledby="insights-heading">
          <h2 id="insights-heading">💡 Najważniejsze Wnioski</h2>
          <ul>
            {% for item in insights %}
            <li>{{ item }}</li>
            {% endfor %}
          </ul>
        </section>
        {% endif %}
        
        {% if recommendations %}
        <section class="card" aria-labelledby="recommendations-heading">
          <h2 id="recommendations-heading">🎯 Rekomendacje Biznesowe</h2>
          <ol>
            {% for rec in recommendations %}
            <li>{{ rec }}</li>
            {% endfor %}
          </ol>
        </section>
        {% endif %}
      </div>
      {% endif %}

      <!-- Charts / Visualizations -->
      {% if charts %}
      <section class="card" aria-labelledby="charts-heading">
        <h2 id="charts-heading">📊 Wizualizacje</h2>
        <div class="grid-2">
          {% for ch in charts %}
          <figure class="figure">
            {% if ch.caption %}
            <figcaption>{{ ch.caption }}</figcaption>
            {% endif %}
            <img 
              src="{{ ch.src }}" 
              alt="{{ ch.alt or 'Wykres ' ~ loop.index }}"
              loading="lazy"
            >
          </figure>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      <!-- Forecast Table -->
      {% if forecast %}
      <section class="card" aria-labelledby="forecast-heading">
        <h2 id="forecast-heading">📈 Prognoza</h2>
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                {% for col in forecast.columns %}
                <th>{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in forecast.rows %}
              <tr>
                {% for col in forecast.columns %}
                <td>{{ row[col] }}</td>
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
      {% endif %}

      <!-- Anomalies -->
      {% if anomalies %}
      <section class="card" aria-labelledby="anomalies-heading">
        <h2 id="anomalies-heading">⚠️ Wykryte Anomalie</h2>
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                {% for col in anomalies.columns %}
                <th>{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in anomalies.rows %}
              <tr>
                {% for col in anomalies.columns %}
                <td>{{ row[col] }}</td>
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
      {% endif %}

      <!-- Model Card -->
      {% if model_card %}
      <section class="card" aria-labelledby="model-heading">
        <h2 id="model-heading">🤖 Karta Modelu</h2>
        <div class="grid-3">
          <div>
            <h3>Tożsamość</h3>
            <dl>
              <dt><strong>Nazwa:</strong></dt>
              <dd>{{ model_card.name or "—" }}</dd>
              
              <dt><strong>Typ:</strong></dt>
              <dd>
                <span class="badge badge--primary">
                  {{ model_card.type or "—" }}
                </span>
              </dd>
              
              <dt><strong>Wersja:</strong></dt>
              <dd>{{ model_card.version or "—" }}</dd>
            </dl>
          </div>
          
          <div>
            <h3>Trenowanie</h3>
            <dl>
              <dt><strong>Dataset:</strong></dt>
              <dd>{{ model_card.dataset or "—" }}</dd>
              
              <dt><strong>Split:</strong></dt>
              <dd>{{ model_card.split or "—" }}</dd>
            </dl>
            
            {% if model_card.hparams %}
            <details>
              <summary><strong>Hiperparametry</strong></summary>
              <pre><code>{{ model_card.hparams | tojson(indent=2, ensure_ascii=False) }}</code></pre>
            </details>
            {% endif %}
          </div>
          
          <div>
            <h3>Metryki</h3>
            {% if model_card.metrics %}
            <div class="table-wrapper">
              <table class="table">
                <tbody>
                  {% for key, value in model_card.metrics.items() %}
                  <tr>
                    <td><strong>{{ key }}</strong></td>
                    <td data-type="number">
                      {% if value is number %}
                        {{ "%.4f"|format(value) }}
                      {% else %}
                        {{ value }}
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <p class="text-muted">Brak danych</p>
            {% endif %}
          </div>
        </div>
      </section>
      {% endif %}

      <!-- Notes -->
      {% if notes %}
      <section class="card" aria-labelledby="notes-heading">
        <h2 id="notes-heading">📝 Notatki</h2>
        <p>{{ notes }}</p>
      </section>
      {% endif %}

    </main>

    <!-- ============================================
         FOOTER
         ============================================ -->
    <footer class="footer" role="contentinfo">
      <p>
        Wygenerowano przez <strong>Intelligent Predictor</strong>
        {% if run_meta and run_meta.timestamp %}
        • <time datetime="{{ run_meta.timestamp }}">{{ run_meta.timestamp }}</time>
        {% endif %}
      </p>
      <p>
        <small>
          <a href="https://github.com/intelligent-predictor" target="_blank" rel="noopener">GitHub</a> •
          <a href="https://docs.intelligent-predictor.io" target="_blank" rel="noopener">Dokumentacja</a>
        </small>
      </p>
    </footer>

  </div>
</body>
</html>